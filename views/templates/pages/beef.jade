extends ../layouts/layout.jade
include ../components/trending_beef/trending_beef.jade
include ../components/timeline/timeline.jade
include ../components/related_beef/related_beef.jade
include ../components/comment_box/comment_box.jade
include ../layouts/section.jade
include ../layouts/masonry_gallery.jade

append body_scripts
    +masonry-gallery-script()
    +timeline-section-js()
    script.
        //Associated Actors
        function formatState (state) {
              if (!state.id || state.element.getAttribute('disabled')) {
                return state.text;
              }
              var $state = $(
                '<span><img style="width: 48px;" src="'+state.element.getAttribute('image_src') + '" class="img-flag" /> ' + state.text + '</span>'
              );
              return $state;
            };


            //Also appears in selector
            var aaisEl = $(".also-appears-in-select");
            aaisEl.select2({
              templateResult: formatState,
              theme: 'classic',
                width: "100%",
                minimumResultsForSearch: -1 //Disable search
            });

            aaisEl.on('select2:select', function (e) {
              var actor_id = e.params.data.id;
              alert("Selected "+actor_id);
            });

append body

    - //insert image resizing into the image URL
    - var split_server_url_prefix = file_server_url_prefix.split("/");
    - split_server_url_prefix.splice(split_server_url_prefix.length-1, 0, "c_fill,g_face,h_150,w_150");
    - var server_url_prefix_with_image_formatting = split_server_url_prefix.join("/");
    
    
    div.bt-content
        div.row.versus-panel
            div.col-5.beefer
                div
                    h4 #{event_data.aggressors[0].name}
                    a(href="/actor/#event_data.aggressors[0]._id")
                        img(src=server_url_prefix_with_image_formatting + "/actors/" + event_data.aggressors[0].img_title_fullsize).actor-avatar

            div.col-2.versus
                h4 VS.
            div.col-5.beefee
                div
                    h4 #{event_data.targets[0].name}
                    a(href="/actor/#event_data.targets[0]._id")
                        img(src=server_url_prefix_with_image_formatting + "/actors/" + event_data.targets[0].img_title_fullsize).actor-avatar
        div.row(style="text-align:center")
            div.col-md-4.offset-md-4
                select.form-control.also-appears-in-select
                    option(selected="selected", disabled="disabled") Also Appears In
                    each aggressor in event_data.aggressors
                        each target in event_data.targets
                            //if aggressor != event_data.aggressors[0] && target != event_data.targets[0]
                            option(image_src=server_url_prefix_with_image_formatting + "/actors/" + event_data.img_title_fullsize, value="obama_vs_trump") #{aggressor.name} v. #{target.name}
        div.row
            +timeline-section(event_data)

        div.beef-content(class="beef-category-#{event_data.categories[0].name.toLowerCase()}")
            div.beef-content-header
                div.beef-title
                    h2
                        | #{event_data.title}
                        span.beefometer.medium.four-beefs
                div.beef-content-category
                    span.category-name #{event_data.categories[0].name}
                div.beef-content-contribute
                    a.btn.btn-primary(href="#") Contribute
            div.beef-content-container
                    div.col-md-12.beef-summary
                        div.beef-thumb
                            img(src=server_url_prefix_with_image_formatting + "/events/" + event_data.img_title_fullsize).float-left
                            div.beef-content-thumb-border
                        p.
                            #{event_data.description}
                        +related-beefs()
                        //p.
                            Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod
                            tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam,
                            quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo
                            consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse
                            cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non
                            proident, sunt in culpa qui officia deserunt mollit anim id est laborum.
                        //p.
                            Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod
                            tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam,
                            quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo
                            consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse
                            cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non
                            proident, sunt in culpa qui officia deserunt mollit anim id est laborum.

                        //div.beef-body-content-soundcloud
                            iframe(height="300", scrolling="no", frameborder="no", allow="autoplay", src="https://w.soundcloud.com/player/?url=https%3A//api.soundcloud.com/tracks/34019569&color=%23ff5500&auto_play=false&hide_related=false&show_comments=true&show_user=true&show_reposts=false&show_teaser=true&visual=true")

                        //p.
                            Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod
                            tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam,
                            quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo
                            consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse
                            cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non
                            proident, sunt in culpa qui officia deserunt mollit anim id est laborum.

                        //div.beef-body-content-youtube-video
                            iframe(height="315", scrolling="no", frameborder="no", src="https://www.youtube.com/embed/_CL6n0FJZpk", allow="autoplay; encrypted-media")
            +section('EXPLORE', 'GALLERY', '')
                +masonry-gallery-section(event_data.gallery_items, "events")
            +comment-box-section(comment_data)


