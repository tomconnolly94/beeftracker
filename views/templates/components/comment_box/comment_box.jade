include ./comment_box_display.jade

mixin comment-box(comments, content_classification)

    - //insert image resizing into the image URL
    - var split_server_url_prefix = file_server_url_prefix.split("/");
    - split_server_url_prefix.splice(split_server_url_prefix.length-1, 0, "c_fill,g_face,h_65,w_65");
    - var server_url_prefix_with_image_formatting = split_server_url_prefix.join("/");

    - console.log(content_classification)

    div.row.comment-box
        div.col-md-12
            div.row
                div.col-md-12
                    - if(!user_data)    
                        p
                            | You must be logged in to comment.&nbsp;
                            a(href="#", data-toggle="modal", data-target="#login_modal") Login
            div.row.new-comment
                div.col-md-1.d-none.d-md-block.d-lg-block.d-xl-block
                    - if(user_data)
                        img#user_img(src=server_url_prefix_with_image_formatting + "/user_profiles/" + user_data.img_title, x-user-id=user_data._id, x-content-type=content_classification).img-fluid
                    - else
                        img(src=server_url_prefix_with_image_formatting + "/user_profiles/default").img-fluid
                div.col-md-11
                    div.row
                        div.col-md-12
                            form
                                - if(user_data)
                                    div.col-md-12
                                        textarea.form-control#comment_text_area
                                    div.col-md-12
                                        button.btn.btn-primary.float-right#submit_comment(type="submit") Submit
                                - else
                                    div.col-md-12
                                        textarea.form-control#comment_text_area(disabled)
                                    div.col-md-12
                                        button.btn.btn-primary.float-right#submit_comment(type="submit", disabled) Submit
            div#comment_box_display
                +comment-box-display(comments)
                
    append scripts
        script(src="/component_controllers/comment_box/comment_box_controller.js")

mixin comment-box-section(data, content_classification)
    //+section('BEEF', 'COMMENTS', 'fa-comments')
    +section('D', 'ISCUSSION', 'fa-comments')
        +comment-box(data, content_classification)
